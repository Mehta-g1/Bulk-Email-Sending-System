{% extends "CreateUser/base.html" %}
{% load static %}
{% block content %}




<div class="container card col-5 mt-3 p-2 rounded-4 shadow-lg">
  <form id="registerForm" action=" {% url "signUp" %} " method="POST">
        <h2 class="text-center">Create New Account</h2>
        <hr>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% csrf_token %}
        <div class="row  mx-auto">
            <div class="mb-2">
                <label for="name" class="form-label" ><b>Enter full name</b></label>
                <input type="text" class="form-control" id="name" name="name" placeholder="Full Name" required>
            </div>
            <div class="mb-2">
                <label for="phone" class="form-label"><b>Phone Number</b></label>
                <input type="text" class="form-control" id="phone" name="phone" placeholder="Phone Number" required>
                
            </div>

            <div class="mb-2">
                <label for="exampleInputEmail1" class="form-label "><b>Email address</b></label>
                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" name='email' placeholder="Enter email" required>
            </div>

            <div class="mb-2">
                <label for="exampleInputPassword1" class="form-label" id='passlabel'><b>Password</b></label>
                <input type="password" class="form-control" id="exampleInputPassword1" name="password" placeholder="Password" required>
                <p class="info-for-password text-danger"> </p>
            </div>
            <div class="mb-2">
                <label for="exampleInputPassword2" class="form-label" id='cpasslabel'><b> Confirm Password</b></label>
                <input type="password" class="form-control" id="exampleInputPassword2" name="c_password" placeholder="Confirm Password" required>
                <p class="info-for-cpassword text-danger"></p>
            </div>
            <div class=" ms-3 form-check">
                <input type="checkbox" class="form-check-input" id="exampleCheck1" required>
                <label class="form-check-label" for="exampleCheck1">Agree <a href="#">Term & Conditions</a></label>
            </div>
        </div>
        <div class=" text-center mt-4 ">
            <button type="submit" id="submitBtn" class="btn btn-primary btn-lg mb-3"><b>Submit</b></button>
        </div>
        <p class=" text-center">Already have an account? <a href=" {% url "Login" %}">Login</a></p>
    </form> 







</div>
<script src="{% static 'js/CreateUser/password.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        setTimeout(function () {
            let alerts = document.querySelectorAll('.alert'); // Changed from .alert1 to .alert
            alerts.forEach(function (alert) {
                let bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 2000);

        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', function (event) {
                const inputs = registerForm.querySelectorAll('input, textarea'); // Removed trailing comma
                let allFieldsFilled = true;

                for (let i = 0; i < inputs.length; i++) {
                    // Exclude the checkbox from the "all fields filled" check
                    if (inputs[i].type !== 'hidden' && inputs[i].type !== 'checkbox' && inputs[i].value.trim() === '') {
                        allFieldsFilled = false;
                        break;
                    }
                }
                if (!allFieldsFilled) {
                    event.preventDefault();
                    alert('Please fill out all fields.');
                }
                // Also prevent submission if passwords don't match or don't meet criteria
                if (!passwordCheck()) {
                    event.preventDefault();
                }
            });
        }
    });

    const passwordinfo = document.querySelector('.info-for-password');
    const cpasswordinfo = document.querySelector('.info-for-cpassword');
    const passwordInput = document.getElementById('exampleInputPassword1');
    const confirmPasswordInput = document.getElementById('exampleInputPassword2');

    passwordinfo.style.display = 'none';
    cpasswordinfo.style.display = 'none';

    // Add event listeners to password fields for real-time validation
    passwordInput.addEventListener('input', passwordCheck);
    confirmPasswordInput.addEventListener('input', passwordCheck);

    function passwordCheck() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        let passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
        let isValid = true;

        // Reset styles and messages
        passwordInput.style.border = '';
        confirmPasswordInput.style.border = '';
        passwordinfo.style.display = 'none';
        cpasswordinfo.style.display = 'none';

        if (password !== confirmPassword && confirmPassword !== '') { // Only show mismatch if confirm password is not empty
            passwordInput.style.border = '1px solid red';
            confirmPasswordInput.style.border = 'red 1px solid';
            passwordinfo.innerHTML = "Passwords do not match.";
            cpasswordinfo.innerHTML = "Passwords do not match.";
            passwordinfo.style.display = 'block';
            cpasswordinfo.style.display = 'block';
            isValid = false;
        }

        if (!passwordRegex.test(password) && password !== '') { // Only show regex error if password is not empty
            passwordInput.style.border = '1px solid red';
            passwordinfo.innerHTML = "Password must be at least 6 characters long and include uppercase, lowercase, and a number.";
            passwordinfo.style.display = 'block';
            isValid = false;
        }

        if (!passwordRegex.test(confirmPassword) && confirmPassword !== '' && password === confirmPassword) { // Only show regex error if confirm password is not empty and matches
            confirmPasswordInput.style.border = 'red 1px solid';
            cpasswordinfo.innerHTML = "Password must be at least 6 characters long and include uppercase, lowercase, and a number.";
            cpasswordinfo.style.display = 'block';
            isValid = false;
        }

        if (isValid && password !== '' && confirmPassword !== '') { // If all checks pass and fields are not empty
            passwordInput.style.border = '1px solid green';
            confirmPasswordInput.style.border = '1px solid green';
        }
        return isValid;
    }
</script>
{% endblock %}